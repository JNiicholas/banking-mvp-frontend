<header class="app-header">
  <div class="brand">
    <button type="button" class="name text-primary brand-link" (click)="goHome()" aria-label="Go to home">
      <i class="pi pi-globe mr-2"></i> Banking App
    </button>
  </div>

  <!-- MegaMenu -->
  <p-megaMenu
    [model]="items"
    orientation="horizontal"
    class="main-megamenu topbar-mega"
  ></p-megaMenu>

  <!-- Right side actions -->
  <div class="header-actions">
    @if (userLoggedIn) {
      <p-avatar
        icon="pi pi-user"
        class="mr-2 cursor-pointer"
        size="large"
        style="background-color: var(--p-button-primary-background); color: var(--p-button-primary-color);"
        shape="circle"
        (click)="userPopover.toggle($event)"
        aria-label="Open user menu"
      />
    } @else {
      <button
        pButton
        type="button"
        icon="pi pi-sign-in"
        label="Login"
        class="p-button"
        (click)="login()"
        aria-label="Login"
      ></button>
    }
  </div>

  <p-popover #userPopover>
    <div class="flex flex-col gap-4 min-w-64">
      <div class="flex items-center gap-3">
        <p-avatar
          icon="pi pi-user"
          size="large"
          style="background-color: var(--p-button-primary-background); color: var(--p-button-primary-color);"
          shape="circle"
        />
        <div>
          <span class="font-medium block">{{ userFirstName || 'User' }} {{ userLastName || '' }}</span>
          <div class="text-sm text-surface-500 dark:text-surface-400">{{ userEmail || '' }}</div>
        </div>
      </div>

      @if (userRoles.length) {
        <span class="font-medium block mb-2">Roles</span>
        <div class="flex flex-wrap gap-2">
          @for (role of userRoles; track role) {
            <p-chip [label]="role"></p-chip>
          }
        </div>
      } @else {
        <div class="text-sm text-surface-500 dark:text-surface-400">No roles</div>
      }

      @if (userLoggedIn) {
        <div class="pt-2 border-t border-surface-200 dark:border-surface-700">
          <button
            pButton
            type="button"
            icon="pi pi-sign-out"
            label="Logout"
            class="p-button-text w-full justify-start"
            (click)="logout()"
          ></button>
        </div>
      }
    </div>
  </p-popover>
</header>